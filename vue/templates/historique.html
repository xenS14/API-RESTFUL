<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/homepage.css') }}">
    <title>{{title}}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<header>
    <div class="header">
        <h1 class="username">Jack Thiem</h1>
        <button class="disconnect-btn">Déconnexion</button>
    </div>
</header>

<body onload="creeBtnRadSonde()">
    <h1 class="map-title">Où se situe la sonde ?</h1>
    <div class="map-container">
        <iframe class="map"
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d90493.80973865828!2d-0.668412091779334!3d44.863688174378176!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xd5527e8f751ca81%3A0x796386037b397a89!2sBordeaux!5e0!3m2!1sfr!2sfr!4v1700658614047!5m2!1sfr!2sfr"
            width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
    </div>
    <div class="graph-container">
        <div class="graph-buttons">
            <button id="temp-btn" onclick="afficherGraphique('temperature', document.querySelector('input[name=sonde]:checked').value, '12')">Température</button>
            <button id="hum-btn" onclick="afficherGraphique('humidite', document.querySelector('input[name=sonde]:checked').value, '12')">Humidité</button>
            <button id="histo-btn" onclick="window.location='http://127.0.0.1:5000/historique/62182233/3'">Historique</button>
            <fieldset>
                <legend>Sélectionnez une sonde :</legend>
                <div id="select-sensor">
                {% for i in range(capteurs|length) %}
                {% if i == 0 %}
                <input type="radio" id={{ capteurs[i].nom }} name="sonde" value={{ capteurs[i].idsonde }} checked>
                {% else %}
                <input type="radio" id={{ capteurs[i].nom }} name="sonde" value={{ capteurs[i].idsonde }}>
                {% endif %}
                <label for={{ capteurs[i].nom }}>{{ capteurs[i].nom }}</label>
                {% endfor %}
                </div>
              </fieldset>
        </div>
        <div id="monChart">
            {% if data|length > 0 %}
            <div class="divtab">
                <fieldset>
                    <legend>Nombre de relevés souhaités :</legend>
                    <div id="select-sensor">
                    <input type="radio" id="nb5" name="nbrel" value="5" checked>
                    <label for="nb5">5</label>
                    <input type="radio" id="nb15" name="nbre2" value="15" checked>
                    <label for="nb15">15</label>
                    <input type="radio" id="nb30" name="nbre3" value="30" checked>
                    <label for="nb30">30</label>
                    <input type="radio" id="nb100" name="nbre4" value="100" checked>
                    <label for="nb100">100</label>
                    </div>
                  </fieldset>
                <p id="presenttab">Les derniers relevés</p>
                <table class="tabdatas">
                    <tr>
                        <td class="coltitre">Sonde</td>
                        <td class="coltitre">Température</td>
                        <td class="coltitre">Humidité</td>
                        <td class="coltitre">Date du relevé</td>
                    </tr>
                    {% for elt in data %}
                    <tr>
                        <td>{{ elt.nom }}</td>
                        <td>{{ elt.temp }}°C</td>
                        {% if elt.humid != '' %}
                        <td>{{ elt.humid }}%</td>
                        {% else %}
                        <td class="sanshumid">-</td>
                        {% endif %}
                        <td>{{ elt.date }}</td>
                    </tr>
                    {% endfor %}
                </table>
                {% else %}
                <p>Il n'y a pas de données à afficher.</p>
                {% endif %}
            </div>
        </div>
        <div>
            <canvas id="myChart" width="400" height="200"></canvas>
        </div>
    </div>
        
    <div id="letest"></div>
        <h1 class="map-title">Mes alertes :</h1>
    <div class="alerte-container">
        <p class="title-alerte">Vous avez {{ lesalertes|length }} alertes :</p>
        {% for i in range(lesalertes|length) %}
            <p>Alerte n°{{ i+1 }} : {{ lesalertes[i].type }}  {{ lesalertes[i].operateur }} {{ lesalertes[i].seuil }} || Envoi toutes les {{ lesalertes[i].freq }} heures<br></p>
        {% endfor %}
        <div class="alert-buttons">
            <button id="cree-alerte-btn" onclick="window.location='http://127.0.0.1:5000/param_alertes'">Créer une alerte</button>
        </div>
    </div>

    <script src="static/js/homepage.js"></script>
</body>
<!-- <footer>
    <h2 class="ip-adress">Adresse IP : 10.133.130.88</h2>
</footer> -->
